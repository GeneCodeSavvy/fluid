apiVersion: batch/v1
kind: Job
metadata:
  name: hostpath-fluid-test
spec:
  backoffLimit: 1
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: busybox
          image: busybox
          resources:
            limits:
              memory: "512Mi"
              ephemeral-storage: "5Gi"
          command: ["/bin/sh"]
          args:
          - -c
          - |
            set -ex
            echo "=== Verifying data mount ==="
            test -n "$(ls /data)"
            echo "=== Files in mount ==="
            ls -la /data
            echo "=== Read throughput test ==="
            start_time=$(date +%s)
            find /data -type f -exec cat {} + > /dev/null 2>&1 || true
            end_time=$(date +%s)
            elapsed=$((end_time - start_time))
            echo "Read all files completed in ${elapsed}s"
          volumeMounts:
            - mountPath: /data
              name: fluid-vol
      automountServiceAccountToken: false
      volumes:
        - name: fluid-vol
          persistentVolumeClaim:
            claimName: hostpath-data
